/**
 * angular-growl-v2 - v0.7.9 - 2016-10-20
 * http://janstevens.github.io/angular-growl-2
 * Copyright (c) 2016 Marco Rinck,Jan Stevens,Silvan van Leeuwen; Licensed MIT
 */
angular.module("angular-growl",[]),angular.module("angular-growl").directive("growl",[function(){"use strict";return{restrict:"A",templateUrl:"templates/growl/growl.html",replace:!1,scope:{reference:"@",inline:"=",limitMessages:"="},controller:["$scope","$interval","growl","growlMessages",function(a,b,c,d){a.referenceId=a.reference||0,d.initDirective(a.referenceId,a.limitMessages),a.growlMessages=d,a.inlineMessage=angular.isDefined(a.inline)?a.inline:c.inlineMessages(),a.$watch("limitMessages",function(b){var c=d.directives[a.referenceId];angular.isUndefined(b)||angular.isUndefined(c)||(c.limitMessages=b)}),a.stopTimeoutClose=function(a){a.clickToClose||(angular.forEach(a.promises,function(a){b.cancel(a)}),a.close?d.deleteMessage(a):a.close=!0)},a.alertClasses=function(a){return{"alert-success":"success"===a.severity,"alert-error":"error"===a.severity,"alert-danger":"error"===a.severity,"alert-info":"info"===a.severity,"alert-warning":"warning"===a.severity,icon:a.disableIcons===!1,"alert-dismissable":!a.disableCloseButton}},a.showCountDown=function(a){return!a.disableCountDown&&a.ttl>0},a.wrapperClasses=function(){var b={};return b["growl-fixed"]=!a.inlineMessage,b[c.position()]=!0,b},a.computeTitle=function(a){var b={success:"Success",error:"Error",info:"Information",warn:"Warning"};return b[a.severity]}}]}}]),angular.module("angular-growl").run(["$templateCache",function(a){"use strict";void 0===a.get("templates/growl/growl.html")&&a.put("templates/growl/growl.html",'<div class="growl-container" ng-class="wrapperClasses()"><div class="growl-item alert" ng-repeat="message in growlMessages.directives[referenceId].messages" ng-class="alertClasses(message)" ng-click="stopTimeoutClose(message)" ng-mouseenter="(message.pauseOnMouseOver) == true ? stopTimeoutClose(message) : null" ng-mouseleave="(message.pauseOnMouseOver) == true ? stopTimeoutClose(message) : null"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" ng-click="growlMessages.deleteMessage(message)" ng-if="!message.disableCloseButton">&times;</button><button type="button" class="close" aria-hidden="true" ng-if="showCountDown(message)">{{message.countdown}}</button><h4 class="growl-title" ng-if="message.title" ng-bind="message.title"></h4><div class="growl-message" ng-bind-html="message.text"></div></div></div>')}]),angular.module("angular-growl").provider("growl",function(){"use strict";var a={success:null,error:null,warning:null,info:null},b="messages",c="text",d="title",e="severity",f="ttl",g=!0,h="variables",i="referenceId",j=0,k=!1,l="top-right",m=!1,n=!1,o=!1,p=!1,q=!1,r=!0;this.globalTimeToLive=function(b){if("object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);else for(var d in a)a.hasOwnProperty(d)&&(a[d]=b);return this},this.globalTranslateMessages=function(a){return r=a,this},this.globalDisableCloseButton=function(a){return m=a,this},this.globalDisableIcons=function(a){return n=a,this},this.globalPauseOnMouseOver=function(a){return o=a,this},this.globalReversedOrder=function(a){return p=a,this},this.globalDisableCountDown=function(a){return q=a,this},this.messageVariableKey=function(a){return h=a,this},this.globalInlineMessages=function(a){return k=a,this},this.globalPosition=function(a){return l=a,this},this.messagesKey=function(a){return b=a,this},this.messageTextKey=function(a){return c=a,this},this.messageTitleKey=function(a){return d=a,this},this.messageSeverityKey=function(a){return e=a,this},this.messageTTLKey=function(a){return f=a,this},this.messageReferenceIdKey=function(a){return i=a,this},this.onlyUniqueMessages=function(a){return g=a,this},this.serverMessagesInterceptor=["$q","growl",function(a,c){function d(a){void 0!==a&&a.data&&a.data[b]&&a.data[b].length>0&&c.addServerMessages(a.data[b])}return{response:function(a){return d(a),a},responseError:function(b){return d(b),a.reject(b)}}}],this.$get=["$rootScope","$interpolate","$sce","$filter","$interval","growlMessages",function(b,s,t,u,v,w){function x(a){if(J&&a.translateMessage)a.text=J(a.text,a.variables)||a.text,a.title=J(a.title)||a.title;else{var c=s(a.text);a.text=c(a.variables)}var d=w.addMessage(a);return b.$broadcast("growlMessage",a),v(function(){},0,1),d}function y(b,c,d){var e,f=c||{};return e={text:b,title:f.title,severity:d,ttl:f.ttl||a[d],variables:f.variables||{},disableCloseButton:void 0===f.disableCloseButton?m:f.disableCloseButton,disableIcons:void 0===f.disableIcons?n:f.disableIcons,pauseOnMouseOver:void 0===f.pauseOnMouseOver?o:f.pauseOnMouseOver,disableCountDown:void 0===f.disableCountDown?q:f.disableCountDown,position:f.position||l,referenceId:f.referenceId||j,translateMessage:void 0===f.translateMessage?r:f.translateMessage,destroy:function(){w.deleteMessage(e)},setText:function(a){e.text=t.trustAsHtml(String(a))},onclose:f.onclose,onopen:f.onopen},x(e)}function z(a,b){return y(a,b,"warning")}function A(a,b){return y(a,b,"error")}function B(a,b){return y(a,b,"info")}function C(a,b){return y(a,b,"success")}function D(a,b,c){return c=(c||"error").toLowerCase(),y(a,b,c)}function E(a){if(a&&a.length){var b,g,j,k;for(k=a.length,b=0;k>b;b++)if(g=a[b],g[c]){j=(g[e]||"error").toLowerCase();var l={};l.variables=g[h]||{},l.title=g[d],g[f]&&(l.ttl=g[f]),g[i]&&(l.referenceId=g[i]),y(g[c],l,j)}}}function F(){return g}function G(){return p}function H(){return k}function I(){return l}var J;w.onlyUnique=g,w.reverseOrder=p;try{J=u("translate")}catch(K){}return{warning:z,error:A,info:B,success:C,general:D,addServerMessages:E,onlyUnique:F,reverseOrder:G,inlineMessages:H,position:I}}]}),angular.module("angular-growl").service("growlMessages",["$sce","$interval",function(a,b){"use strict";function c(a){var b;return b=f[a]?f[a]:f[a]={messages:[]}}function d(a){var b=a||0;return e.directives[b]||f[b]}var e=this;this.directives={};var f={};this.initDirective=function(a,b){return f[a]?(this.directives[a]=f[a],this.directives[a].limitMessages=b):this.directives[a]={messages:[],limitMessages:b},this.directives[a]},this.getAllMessages=function(a){a=a||0;var b;return b=d(a)?d(a).messages:[]},this.destroyAllMessages=function(a){for(var b=this.getAllMessages(a),c=b.length-1;c>=0;c--)b[c].destroy();var e=d(a);e&&(e.messages=[])},this.addMessage=function(d){var e,f,g,h;if(e=this.directives[d.referenceId]?this.directives[d.referenceId]:c(d.referenceId),f=e.messages,!this.onlyUnique||(angular.forEach(f,function(b){h=a.getTrustedHtml(b.text),d.text===h&&d.severity===b.severity&&d.title===b.title&&(g=!0)}),!g)){if(d.text=a.trustAsHtml(String(d.text)),d.ttl&&-1!==d.ttl&&(d.countdown=d.ttl/1e3,d.promises=[],d.close=!1,d.countdownFunction=function(){d.countdown>1?(d.countdown--,d.promises.push(b(d.countdownFunction,1e3,1,1))):d.countdown--}),angular.isDefined(e.limitMessages)){var i=f.length-(e.limitMessages-1);i>0&&f.splice(e.limitMessages-1,i)}if(this.reverseOrder?f.unshift(d):f.push(d),"function"==typeof d.onopen&&d.onopen(),d.ttl&&-1!==d.ttl){var j=this;d.promises.push(b(angular.bind(this,function(){j.deleteMessage(d)}),d.ttl,1,1)),d.promises.push(b(d.countdownFunction,1e3,1,1))}return d}},this.deleteMessage=function(a){var b=this.getAllMessages(a.referenceId),c=-1;for(var d in b)b.hasOwnProperty(d)&&(c=b[d]===a?d:c);c>-1&&(b[c].close=!0,b.splice(c,1)),"function"==typeof a.onclose&&a.onclose()}}]);

window._modules={},window.require=function(e){return e=e.replace("./",""),(window._modules[e]||{}).exports||{}},window._modules.utils={exports:{}},function(e){function r(e){for(var o=[],i=0,n=e.length;i<n;i++)o[i]=e[i];return o}e.exports={iran:function(e,o){return Math.round(Math.random()*(o-e))+e},pick:function(e){return e[Math.floor(Math.random()*e.length)]},range:function(e,o){for(var i=[],n=e;n<=o;n++)i.push(n);return i},shuffle:function(e){for(var o=r(e),i=o.length-1;0<i;i--){var n=Math.floor(Math.random()*(i+1)),t=o[i];o[i]=o[n],o[n]=t}return o},sort:function(e,o){o=e.splice(0,o);return o.sort(function(e,o){return e-o}),o},listClone:r,Bolla:function(e,o,i,n,t,r){this.id=e,this.number=o,this.latex=i,this.speech=n,this.ttl=t||15,this.remaining=r},extend:function(e,o){function i(){}i.prototype=o.prototype,e.prototype=new i,e.prototype.constructor=o},equalSets:function(e,o){if(e.length!=o.length)return!1;for(var i=0;i<e.length;i++)if(o.indexOf(e[i])<0)return!1;for(i=0;i<o.length;i++)if(e.indexOf(o[i])<0)return!1;return!0}}}(window._modules.utils),window._modules.cartro={exports:{}},function(e){function n(e,o){this.value=e,this.selected=o}var a=require("utils");n.prototype.clear=function(){this.value=null,this.selected=!1},n.prototype.toggle=function(e){e&&(this.selected=!this.selected)};function o(){this.nrows=3,this.ncols=6,this.rows=[];for(var e=0;e<this.nrows;e++){for(var o=[],i=0;i<this.ncols;i++)o.push(new n(null,!1));this.rows.push(o)}this.generate()}o.prototype={generate:function(){for(var e=[],o=0;o<this.nrows;o++)e.push(a.sort(a.shuffle(a.range(0,this.ncols-1)),3));for(var i=1,n=0;n<this.ncols;n++){for(var t=a.sort(a.shuffle(a.range(i,i+4)),this.nrows),r=0,o=0;o<this.nrows;o++){var s=null;e[o].indexOf(n)<0&&(s=t[r],r++),this.getCellAt(o,n).value=s}i+=5}},clear:function(){for(var e=0;e<this.nrows;e++)for(var o=0;o<this.ncols;o++)this.getCellAt(e,o).clear()},getRows:function(){return this.rows},getCellAt:function(e,o){return this.rows[e][o]},list:function(){for(var e=[],o=0;o<this.nrows;o++)for(var i=this.rows[o],n=0;n<this.ncols;n++){var t=i[n];null!=t.value&&e.push(t.selected?t.value:null)}return e},testLine:function(e,o){o&&(this.nombres_trets=o);for(var i=-1,n=0;n<this.nrows;n++){for(var t=!0,r=0;r<3;r++){var s=3*n+r,a=e[s];if(null==a){t=!1;break}if(!(t=0<=this.nombres_trets.indexOf(a))){i=s;break}}if(t)return[!0]}return[!1,i]},testBingo:function(e,o){o&&(this.nombres_trets=o);for(var i=0;i<this.nrows;i++)for(var n=0;n<3;n++){var t=3*i+n,r=e[t];if(null==r||this.nombres_trets.indexOf(r)<0)return[!1,t]}return[!0]},mark:function(e){for(var o=0;o<this.nrows;o++)for(var i=0;i<3;i++){var n=this.getCellAt(o,i);if(null!=n.value&&n.value==e)return void(n.selected=!0)}}},e.exports=o}(window._modules.cartro),window._modules.timer={exports:{}},function(e){function o(e,o){this.cb=e,this._start=null,this.remaining=1e3*o}o.prototype={play:function(e){this.id&&clearTimeout(this.id),this._start&&(this.remaining-=(new Date).getTime()-this._start),e&&(this.remaining=1e3*e),this._start=(new Date).getTime(),this.id=setTimeout(this.cb,this.remaining)},stop:function(){this.id&&(clearTimeout(this.id),this.id=null),this._start=null,this.remaining=0},pause:function(){this.id&&(clearTimeout(this.id),this.id=null),this._start&&(this.remaining-=(new Date).getTime()-this._start)}},e.exports=o}(window._modules.timer),window._modules.bot_player={exports:{}},function(e){function o(){this.lineAllowed=!0,this.bingoAllowed=!0,this.cartro=new i,this.cartro.generate()}var i=require("cartro");o.prototype.disableLine=function(){this.lineAllowed=!1},o.prototype.disableBingo=function(){this.bingoAllowed=!1},o.prototype.receiveBall=function(e,o,i){var n=this;this.cartro.mark(e.number);var t,r=0,s=n.cartro.list();console.log("Flatten",s," Nombres trets",o),n.lineAllowed?((t=n.cartro.testLine(s,o)[0])&&(n.lineAllowed=!1),r=t?1:0):n.bingoAllowed&&((o=n.cartro.testBingo(s,o)[0])&&(n.lineAllowed=!1,n.bingoAllowed=!1),r=o?2:0),setTimeout(function(){i(r)},700*e.ttl)},e.exports=o}(window._modules.bot_player),window._modules.bingo_classic={exports:{}},function(e){function BasicGenerator(){}var n=require("./utils"),o=require("./timer"),i=require("./bot_player");function BingoClassic(){this.bot=new i,this.generator=new BasicGenerator,this.isPlaying=!1,this.askedParticipants=[],this.gameoverNotifiers=[],this.nextballNotifiers=[],this.botNotifiers=[],this.timer=null,this.lineaOwner=null,this.winner=null,this.itera=0;var n=this;this.timer=new o(function(){var e=n.next();if(e){for(var o=0,i=n.nextballNotifiers.length;o<i;o++)n.nextballNotifiers[o](e);n.timer.play(e.ttl||5),n.bot.receiveBall(e,n.nombres_trets,function(e){for(var o=0,i=n.botNotifiers.length;o<i;o++)n.botNotifiers[o](e)})}else{for(o=0,i=n.gameoverNotifiers.length;o<i;o++)n.gameoverNotifiers[o](null);n.bot.disableBingo(),n.bot.disableLine()}},5)}BasicGenerator.prototype._createBall=function(e,o,i){return new n.Bolla(e+1,o,"<span>"+o+"</span>",{"ca-ES":"El "+o,"es-ES":"El "+o},10,i)},BingoClassic.prototype.init=function(){this.itera=0,this.askedParticipants=[],this.nombres=n.shuffle(n.range(1,30)),this.nombres_trets=[],this.bolles=[];for(var e=0;e<30;e++)this.bolles.push(this.generator._createBall(e,this.nombres[e],30-e-1));this.isPlaying=!0,this.timer&&this.timer.play()},BingoClassic.prototype.next=function(){if(this.askedParticipants=[],30<=this.itera||null!=this.winner){for(var e=0,o=this.gameoverNotifiers.length;e<o;e++)this.gameoverNotifiers[e](this.winner);return this.isPlaying=!1,null}var i=this.bolles[this.itera];return this.nombres_trets.push(this.nombres[this.itera]),this.itera++,i},BingoClassic.prototype.testLine=function(e,o){for(var i=-1,n=0;n<3;n++){for(var t=!0,r=0;r<3;r++){var s=3*n+r,a=e[s];if(null==a){t=!1;break}if(!(t=0<=this.nombres_trets.indexOf(a))){i=s;break}}if(t)return null!=this.lineaOwner?[]:(this.lineaOwner=o,[!0])}return[!1,i]},BingoClassic.prototype.testBingo=function(e,o){for(var i=0;i<3;i++)for(var n=0;n<3;n++){var t=3*i+n,r=e[t];if(null==r||this.nombres_trets.indexOf(r)<0)return[!1,t]}if(null!=this.winner)return[];this.winner=o,this.timer&&this.timer.pause(),this.timer=null;for(var i=0,s=this.gameoverNotifiers.length;i<s;i++)this.gameoverNotifiers[i](this.winner);return[!(this.isPlaying=!1)]},BingoClassic.prototype.on=function(e,o){"nextball"===e?this.nextballNotifiers.push(o):"gameover"===e?this.gameoverNotifiers.push(o):"bot"===e&&this.botNotifiers.push(o)},BingoClassic.prototype.off=function(){this.isPlaying=!1,this.nextballNotifiers=[],this.gameoverNotifiers=[],this.botNotifiers=[],this.timer&&this.timer.pause(),this.timer=null},BingoClassic.prototype.trigger=function(e){var o=this;setTimeout(function(){o.init()},1e3*e)},BingoClassic.prototype.pause=function(){this.timer&&this.timer.pause()},BingoClassic.prototype.play=function(){this.timer&&this.timer.play()},BingoClassic.prototype.canSendNext=function(e,o){return this.askedParticipants.indexOf(e)<0&&this.askedParticipants.push(e),!(null!=o&&!n.equalSets(this.askedParticipants,o))&&(this.timer&&this.timer.pause(),this.timer&&this.timer.play(1),this.askedParticipants=[],!0)},BingoClassic.prototype.setGenerator=function(e){this.generator=e||new BasicGenerator},e.exports=BingoClassic}(window._modules.bingo_classic),window._modules.dif_generator={exports:{}},function(e){function DifGenerator(){}var n=require("./utils");DifGenerator.prototype._createBall=function(e,o,i){return new n.Bolla(e+1,o,"<span>"+o+"</span>",{"ca-ES":"El "+o,"es-ES":"El "+o},20,i)},e.exports=DifGenerator}(window._modules.dif_generator),window._modules.eqn_generator={exports:{}},function(e){function EqnGenerator(){this.eqnTemplates=[];for(var e=0;e<30;e++)this.eqnTemplates.push(e%8);p.shuffle(this.eqnTemplates)}var p=require("./utils"),w=[2,3,5,7];EqnGenerator.prototype._createBall=function(e,o,i){var n=this.eqnTemplates[e],t=null,r=null,s=20;if(0==n||1==n)t="x + "+(a=p.iran(2,10))+" = "+(d=o+a),r={"ca-ES":"x més "+a+" és igual a "+d,"es-ES":"x más "+a+" es igual a "+d};else if(2==n||3==n){for(var a,l=p.iran(-5,5);0==l;)l=p.iran(-5,5);t=(a=o+l)+"- x = "+(d=a-o),r={"ca-ES":a+" menys x és igual a "+d,"es-ES":a+" menos x es igual a "+d}}else if(4==n)t=(a=p.iran(2,5))+" x  = "+(d=a*o),r={"ca-ES":a+" x és igual a "+d,"es-ES":a+" x es igual a "+d};else if(5==n)t="\\frac{"+(a=(d=p.iran(2,4))*p.iran(2,5))+" x}{"+d+"}  = "+(v=a*o/d),r={"ca-ES":a+" x dividit entre "+d+" és igual a "+v,"es-ES":a+" x dividido entre  "+d+" es igual a "+v},s=15;else if(6==n)o<=10?(d=2*o,v=o*o,s=30,p.iran(0,1)?(t="x^2  - "+d+"x + "+v+" = 0",r={"ca-ES":"x al quadrat menys "+d+" x més "+v+" igual a zero","es-ES":"x al cuadrado menos "+d+" x más "+v+" igual a cero"},s=60):(t="(x-"+o+")^2 = 0",r={"ca-ES":"x menys "+o+" al quadrat és igual a zero","es-ES":"x menos "+o+" al cuadrado es igual a cero"})):(d=p.iran(2,10),t=(a=(v=p.iran(2,4))*o+d)+" - "+v+" x = "+d,r={"ca-ES":a+" menys "+v+" x és igual a "+d,"es-ES":a+" menos "+v+" x es igual a "+d},s=35);else if(7==n){for(var c=p.iran(4,10),u=p.iran(1,3),d=p.pick(w);d==c;)d=p.pick(w);var m,f,h,g,v=p.iran(1,2),n=p.iran(2,4);s=0==p.iran(0,9)?(t="\\frac{x - "+u+"}{"+d+"} + \\frac{"+(m=(c+u)*v)+"}{"+(f=d*v)+"} = \\frac{"+(h=(o+c)*n)+"}{"+(g=d*n)+"}",r={"ca-ES":"x menys "+u+" dividit entre "+d+" més "+m+" sobre "+f+" igual a "+h+" sobre "+g,"es-ES":"x menos "+u+" dividido entre "+d+" más "+m+" sobre "+f+" igual a "+h+" sobre "+g},60):(t="\\frac{"+(m=1==(m=n)?"":m)+"x + "+(f=c*n)+"}{"+(n=d*n)+"}  = \\frac{"+(h=o+c)+"}{"+(g=d)+"}",r={"ca-ES":m+" x més "+f+" dividit entre "+n+" igual a "+h+" sobre "+g,"es-ES":m+" x más "+f+" dividido entre "+n+" igual a "+h+" sobre "+g},40)}else t="x + "+(a=p.iran(2,10))+" = "+(d=o+a),r={"ca-ES":"x més "+a+" és igual a "+d,"es-ES":"x más "+a+" es igual a "+d};return new p.Bolla(e+1,o,t="<katex>\\displaystyle {"+t+"}</katex>",r,s,i)},e.exports=EqnGenerator}(window._modules.eqn_generator),window._modules.num_generator={exports:{}},function(e){function NumGenerator(){this.myTemplates=[];for(var e=0;e<30;e++)this.myTemplates.push(e%2);a.shuffle(this.myTemplates),this.cache={}}var a=require("./utils");NumGenerator.prototype._createBall=function(e,o,i){if(this.cache[e])return this.cache[e];var n,t,r=null,s=null;r=0===this.myTemplates[e]?o<10?(s=(t=o+(n=a.iran(2,20)))+" - "+n,{"ca-ES":t+" menys "+n,"es-ES":t+" menos "+n}):(s=(t=o-(n=a.iran(1,o-1)))+" + "+n,{"ca-ES":t+" més "+n,"es-ES":t+" más "+n}):20<o?(s=(t=o-(n=a.iran(0,30-o)))+" + "+n,{"ca-ES":t+" més "+n,"es-ES":t+" más "+n}):(s=(t=o+(n=a.iran(1,o-1)))+" - "+n,{"ca-ES":t+" menys "+n,"es-ES":t+" menos "+n});i=new a.Bolla(e+1,o,"<katex>"+s+"</katex>",r,25,i);return this.cache[e]=i},e.exports=NumGenerator}(window._modules.num_generator),window._modules.che_generator={exports:{}},function(e){function CheGenerator(){}var n=require("./utils");CheGenerator.prototype._createBall=function(e,o,i){return new n.Bolla(e+1,o,"<span>"+o+"</span>",{"ca-ES":"El "+o,"es-ES":"El "+o},20,i)},e.exports=CheGenerator}(window._modules.che_generator),window._modules.BingoUtils={exports:{}},function(e){function t(e,o){e=(e||"").toLowerCase();for(var i=0,n=null,t=(o||[]).length;i<t&&null==n;)o[i].lang.toLowerCase()==e&&(n=o[i]),i++;return n}var r=window.speechSynthesis,s=null!=r&&null!=window.SpeechSynthesisUtterance;s||console.error("Voices not supported"),e.exports={speak:function(e){var o,i,n;s&&(o=speechSynthesis.getVoices(),(n=(n=t(i="ca-ES",o))||t(i="es-ES",o))&&((i=new SpeechSynthesisUtterance(e[i])).voice=n,r.speak(i)))}}}(window._modules.BingoUtils),function(){!function(){function t(e,o,i){this.fromId=e,this.toId=o,this.payload=i}function i(){return Math.random().toString(32).substring(2)}function n(e){this.id=e,this._handlers={}}n.prototype={removeAllListeners:function(){this._handlers={}},on:function(e,o){var i=this._handlers[e];i||(this._handlers[e]=i=[]),i.push(o)},emit:function(e,o,i){window.ioServerLocal._deliver(new t(this.id,this.id,{evtname:e,data:o,ack:i}))}},window.ioClientLocal={_sockets:{},connect:function(){var e="s"+i()+"-"+i(),o=new n(e);return ioClientLocal._sockets[e]=o,window.ioServerLocal._deliver(new t(e,e,{evtname:"connection",data:e})),o},disconnect:function(){for(var e=Object.values(window.ioClientLocal._sockets),o=0,i=e.length;o<i;o++)e[o].off()},_deliver:function(i){var n,e=window.ioClientLocal._sockets[i.toId];console.log("Client want's to deliver ",i," to ",e),!e||(n=e._handlers[i.payload.evtname])&&setTimeout(function(){for(var e=0,o=n.length;e<o;e++)n[e](i.payload.data,i.payload.cb)},100)}};function a(e){this.id=e,this._handlers={},this._hasJoined=[]}a.prototype={off:function(){this._handlers={},this._hasJoined=[]},emit:function(e,o,i,n){console.log("Server emitting "+e+" to "+this.id),window.ioClientLocal._deliver(new t(n||this.id,this.id,{evtname:e,data:o,ack:i}))},on:function(e,o){console.log("Client recieve ",e);var i=this._handlers[e];i||(this._handlers[e]=i=[]),i.push(o)},join:function(e){this._hasJoined.indexOf(e)<0&&this._hasJoined.push(e)},leave:function(e){e=this._hasJoined.indexOf(e);0<=e&&this._hasJoined.splice(e,1)}},window.ioServerLocal={_clients:{},_handlers:{},_rooms:{},_deliver:function(s){setTimeout(function(){console.log("ioServerLocal: _deliver : ",s);var e=s.payload;if("connection"!==e.evtname)if(o=window.ioServerLocal._clients[s.toId]){n=o._handlers[e.evtname];if(console.log(e.evtname,"handlers ",n),n)for(t=0,r=n.length;t<r;t++)n[t](e.data,e.ack)}else console.error("cannot deliver to ",s.toId);else{var o,i=e.data;(o=window.ioServerLocal._clients[i])||(o=new a(i),window.ioServerLocal._clients[i]=o),console.log("Deliver connection ",o);var n=window.ioServerLocal._handlers.connection;if(console.log("handlers ",window.ioServerLocal._handlers),n)for(var t=0,r=n.length;t<r;t++)n[t](o)}},100)},on:function(e,o){var i=window.ioServerLocal._handlers[e];i||(i=[],window.ioServerLocal._handlers[e]=i),i.push(o)},emit:function(e,o,i){for(var n=Object.values(window.ioServerLocal._clients),t=0;t<n.length;t++)n[t].emit(e,o,i)},to:function(r){return{emit:function(e,o,i){for(var n=Object.values(window.ioServerLocal._clients),t=0;t<n.length;t++)0<=n[t]._hasJoined.indexOf(r)&&n[t].emit(e,o,i,"global")}}},in:function(e){return this.to(e)},shutdown:function(){for(var e=Object.values(ioServerLocal._clients),o=0,i=e.length;o<i;o++)e[o].off();ioServerLocal._clients={},ioServerLocal._handlers={},ioServerLocal._rooms={}}}}();var BingoClassic=require("bingo_classic"),DifGenerator=require("dif_generator"),NumGenerator=require("num_generator"),EqnGenerator=require("eqn_generator"),CheGenerator=require("che_generator"),c={},u={},d={},c={"Equacions Local":{id:"Equacions Local",idUser:"Admin-local",nick:"Admin-local",type:"eqn",created:new Date},"Clàssic Local":{id:"Clàssic Local",idUser:"Admin-local",nick:"Admin-local",type:"cla",created:new Date},"Numeric Local":{id:"Numeric Local",idUser:"Admin-local",nick:"Admin-local",type:"num",created:new Date},"Derivades Local":{id:"Derivades Local",idUser:"Admin-local",nick:"Admin-local",type:"dif",created:new Date},"Química Local":{id:"Química Local",idUser:"Admin-local",nick:"Admin-local",type:"che",created:new Date}},u={"Equacions Local":[{idUser:"localBot",nick:"Bot local"}],"Clàssic Local":[{idUser:"localBot",nick:"Bot local"}],"Numeric Local":[{idUser:"localBot",nick:"Bot local"}],"Derivades Local":[{idUser:"localBot",nick:"Bot local"}],"Química Local":[{idUser:"localBot",nick:"Bot local"}]};ioServerLocal.on("connection",function(l){console.log("Client connected "),l.on("rooms:create",function(e,o){if(console.log(e),10<Object.keys(c).length)o&&o(!1,"No hi pot haver més de 10 actives.");else{for(var i,n=!1,t=Object.values(c),r=0,s=t.length;r<s;r++)if(t[r].idUser==e.idUser){n=!0;break}n?o&&o(!1,"Cada usuari pot crear com a molt una sala."):(i="r"+Math.random().toString(32).substring(2),u[i]=[],c[i]={id:i,idUser:e.idUser,nick:e.nick,type:e.type||"eqn",created:new Date},ioServerLocal.emit("rooms:available",Object.values(c)),o&&o(!0,"S'ha creat la sala amb id "+i))}}),l.on("rooms:info",function(e){l.emit("rooms:info",c[e.id])}),l.on("rooms:available",function(){console.log("ASKING rooms ",c),l.emit("rooms:available",Object.values(c))}),l.on("rooms:participants",function(e){return c[e.id]?void ioServerLocal.to(e.id).emit("rooms:participants",u[e.id]):(console.log("Asking participants of invalid room"),void l.emit("rooms:participants","invalid_room"))}),l.on("rooms:leave",function(e){if(console.log("rooms:leave",e),"*"==e.id&&e.idUser)for(var o=Object.keys(u),i=o.length,n=0;n<i;n++){var t=o[n],r=(a=u[t]).length;console.log("croom",a);for(var s=r-1;0<=s;s--)console.log("Comparant ",a[s].idUser,e.idUser),a[s].idUser==e.idUser&&(console.log("Removing user ",e.idUser," from ",t),a.splice(s,1));console.log("Check purges in ",t),0==a.length&&(console.log("Purging"),console.log("The room croom is empty "),a=null,delete c[t],delete u[t],d[t]&&d[t].off(),delete d[t])}else{if(!c[e.id])return console.log("Asking leave of invalid room ",e.id),void l.emit("rooms:leave","invalid_room");for(var a,s=(r=(a=u[e.id]).length)-1;0<=s;s--)a[s].idUser===e.idUser&&a.splice(s,1);console.log("joined now is ",u[e.id]);0==a.length&&(console.log("Purging"),console.log("The room croom is empty "),a=null,delete c[e.id],delete u[e.id],d[e.id]&&d[e.id].off(),delete d[e.id],ioServerLocal.emit("rooms:available",Object.values(c))),l.leave(e.id),ioServerLocal.to(e.id).emit("rooms:participants",u[e.id])}}),l.on("rooms:join",function(e,o){if(console.log("Passed",e),console.log("Current joined ",u,u[e.id]),u[e.id])if(d[e.id])o&&o(!1,"La sala està jugant en aquests moments. Esperau que acabi.");else{if(30<u[e.id].length)return ioServerLocal.to(e.id).emit("rooms:participants",u[e.id]),void(o&&o(!1,"La sala "+e.id+" està plena. Ja conté 30 jugadors. Creau o entrau a una altra sala."));for(var i=!1,n=0,t=u[e.id].length;n<t&&!i;)i=u[e.id][n].idUser==e.idUser,n++;l.lastRoom&&l.leave(l.lastRoom),l.lastRoom=e.id,i||u[e.id].push({idUser:e.idUser,nick:e.nick}),l.join(e.id),console.log("Emetent participants ",u[e.id]),ioServerLocal.to(e.id).emit("rooms:participants",u[e.id]),o&&o(!0,"T'has unit a la sala "+e.id)}else o&&o(!1,"La sala "+e.id+" ja no existeix.")}),l.on("bingo:start",function(o,e){console.log("Bingo start ",o);var i,n,t=c[o.id];t?d[o.id]&&d[o.id].isPlaying?e&&e(!1,"La sala ja està jugant."):(i=new BingoClassic,n=null,console.log("ABOUT TO SET THE FLAVOR TO ",t.type),"eqn"===t.type?n=new EqnGenerator:"dif"===t.type?n=new DifGenerator:"num"===t.type?n=new NumGenerator:"che"===t.type&&(n=new CheGenerator),n&&i.setGenerator(n),(d[o.id]=i).on("nextball",function(e){console.log("Enviant nova bolla ",e),ioServerLocal.to(o.id).emit("bingo:nextball",e)}),i.on("gameover",function(e){setTimeout(function(){ioServerLocal.to(o.id).emit("bingo:gameover",e),i.off(),i.pause()},1e4)}),i.on("bot",function(e){1==e?ioServerLocal.to(o.id).emit("bingo:linea",{res:[!0],user:{idUser:"localBot",nick:"localBot"}}):2==e&&ioServerLocal.to(o.id).emit("bingo:bingo",{res:[!0],user:{idUser:"localBot",nick:"localBot"}})}),ioServerLocal.to(o.id).emit("bingo:start",o.id),i.trigger(2)):e&&e(!1,"La sala "+o.id+" no existeix.")}),l.on("bingo:linea",function(e){console.log("bingo:linea",e);var o=d[e.id];o.pause();var i=o.testLine(e.numbers,e.user);console.log("bingo:linea result",i),0<i.length&&!0===i[0]?(ioServerLocal.to(e.id).emit("bingo:linea",{res:i,user:e.user}),console.log("Notifying to all")):(l.emit("bingo:linea",{res:i,user:e.user}),console.log("Notifying to user")),setTimeout(function(){o.play()},5e3)}),l.on("bingo:asknext",function(e,o){return console.log("asknext",e),d[e.id]&&d[e.id].canSendNext(e.user.idUser,null)?(console.log("OK. Hauria d'enviar el següent"),void(o&&o(!0))):void 0}),l.on("bingo:bingo",function(e){var o=d[e.id];o.pause();var i=o.testBingo(e.numbers,e.user);(0<i.length&&!0===i[0]?ioServerLocal.to(e.id):l).emit("bingo:bingo",{res:i,user:e.user}),setTimeout(function(){o.play()},5e3)})});var m=require("BingoUtils"),f=require("cartro");angular.module("bingoApp.services",[]).value("version","0.1").factory("socket",["$rootScope","$interval",function(t,e){var r=null,r=window.BINGO_DEV?window.io.connect("http://127.0.0.1:3333"):window.io.connect("https://piworld.es/"),s=ioClientLocal.connect();return t.mode={method:"remote",hasConnection:!0},{on:function(e,o){r.on(e,function(){var e=arguments;t.$apply(function(){o.apply(r,e)})}),s.on(e,function(){var e=arguments;t.$apply(function(){o.apply(s,e)})})},emit:function(e,o,i){var n=r;"offline"!==t.mode.method&&t.mode.hasConnection||(console.log("Offline mode"),n=s),n.emit(e,o,function(){var e=arguments;t.$apply(function(){i&&i.apply(n,e)})})},removeAllListeners:function(){r.removeAllListeners(),s.removeAllListeners(),r.on("connect_error",function(){console.log("connect error Setting "),t.mode.method="offline",t.mode.hasConnection=!1,t.$emit("hasConnection",!1),console.log("connect error Setting and emitting ",t.mode)})}}}]).service("cfg",function(){var o=sessionStorage.getItem("IB.games")||"{}";return(o=JSON.parse(o)).bingo||(o.bingo={}),{getUser:function(){return o.user},setNick:function(e){return o.user?o.user.nick=e:o.user={nick:e,idUser:"u"+Math.random().toString(32).substring(2)},sessionStorage.setItem("IB.games",JSON.stringify(o)),o.user},getBingoFlavor:function(){return"eqn"==window.BINGO_FLAVOR?"E q u a c i o n s":"num"==window.BINGO_FLAVOR?"O p e r a c i o n s":"dif"==window.BINGO_FLAVOR?"D e r i v a d e s":"che"==window.BINGO_FLAVOR?"Q u í m i c a":(window.BINGO_FLAVOR,"C l à s s i c")}}}).directive("katex",[function(){return{restrict:"AE",link:function(e,o){var i=o.html();"DIV"===o[0].tagName&&(i="\\displaystyle {"+i+"}",o.addClass("katex-outer").html()),function(e,o,i){try{e.render(o,i[0])}catch(e){i.html("<div class='alert alert-danger' role='alert'>"+e+"</div>")}}(katex,i,o)}}}]).directive("unsafeHtml",["$compile",function(n){return function(o,i,e){e=e.unsafeHtml;o.$watch(e,function(e){e&&(e=n(e=e)(o),i.html("").append(e))})}}]);var e=angular.module("bingoApp",["ui.router","bingoApp.services","angular-growl"]);e.directive("bingoHeader",function(){return{restrict:"E",transclude:!0,scope:{headerInfo:"=info"},template:'<div class="bingo_header"><div class="user_ball" ng-click="headerInfo.exit()">     <h2 ng-bind="headerInfo.nick | initials" title="{{headerInfo.nick}}"></h2></div> <div>     <h2>B I N G O</h2>     <h3 ng-bind="headerInfo.typeName"></h3> </div><div class="room_exit" ng-show="headerInfo.id">     <p ng-click="headerInfo.exit()" title="Sortir de la sala"><span class="pwi-exit"></span></p>     <p ng-bind="headerInfo.id"></p> </div></div>'}}),e.directive("bingoFooter",function(){return{restrict:"E",transclude:!0,template:'<div class="bingo_footer"><p>(c) Josep Mulet (2021-2022)</p></div>'}}),e.directive("bingoCartro",function(){return{restrict:"E",transclude:!0,scope:{cartro:"=cartro",bingoStarted:"=bingoStarted"},template:'<div> <div ng-repeat="row in cartro.rows" class="cartro_row">    <div ng-click="cell.toggle(bingoStarted)"  ng-repeat="cell in row" class="cartro_cell" ng-class="{\'cartro_cellvoid\': cell.value==null, \'cartro_cellselected\': cell.selected, \'cartro_celledit\': bingoStarted && cell.value!=null}">         <span ng-if="cell.value!=null">{{cell.value}}</span>    </div>  </div></div>'}}),e.filter("initials",function(){return function(e){return angular.isString(e)&&0<e.length?e.charAt(0).toUpperCase():"?"}}),e.filter("minsec",function(){function i(e){return e<10?"0"+e:""+e}return function(e){if(!e||e<0)return"00:00";var o=Math.floor(e/60);return i(o)+":"+i(e%60)}}),e.run(["$rootScope","cfg","socket","growl","$state","$window","$transitions",function(i,n,t,r,e,o,s){o.addEventListener("beforeunload",function(e){var o=n.getUser();o&&t.emit("rooms:leave",{id:"*",idUser:o.idUser})}),i.$on("hasConnection",function(e,o){console.log("on hasConnection ",o),o||i.methodNotified||(i.methodNotified=!0,r.error("Vaja, no hi ha connexió. Estàs en mode fora de línia.",{ttl:-1,referenceId:1}))}),s.onStart({from:"game"},function(e){var o;e.from();"game"!=e.to().name&&(o=e.params("from").idroom,e=n.getUser(),console.log("Leaving room "+o),t.emit("rooms:leave",{id:o,idUser:e.idUser,nick:e.nick}),i.currentRoom=null)}),s.onBefore({},function(e){var o=e.to();if(!i.normalInit&&"home"!=o.name)return e.router.stateService.target("home")})}]);function o(i,n,t,r,e,s){n.normalInit=!0,e.removeAllListeners(),e=r.getUser(),i.flavors=[{url:"./equacions.html",name:"Equacions",alias:"eqn"}],i.currentFlavor=window.BINGO_FLAVOR,i.nick=e?e.nick:"",i.headerInfo={nick:i.nick,id:null,typeName:r.getBingoFlavor(),exit:function(){t.go("home")}},i.onKeyUp=function(e){i.headerInfo.nick=i.nick,13===e.which&&i.onsubmit()},i.onsubmit=function(e,o){i.nick.trim().length?(r.setNick(i.nick),n.mode.hasConnection||"online"!==o?(n.mode.method=o,t.go("rooms")):s.error("No hi ha connexió per a multi jugador.")):s.warning("Escriviu un pseudònim vàlid.")}}function i(r,e,o,i,n,t,s){n.removeAllListeners();var a=i.getUser();a||o.go("home"),n.on("rooms:available",function(e){console.log(e,BINGO_FLAVOR);for(var o=[],i=0,n=e.length;i<n;i++){var t=e[i];t.type==window.BINGO_FLAVOR&&o.push(t)}r.rooms=o}),s(function(){n.emit("rooms:available")},400),r.headerInfo={nick:a.nick,id:null,typeName:i.getBingoFlavor(),exit:function(){o.go("home")}},r.joinroom=function(e){console.log("Attempting join room",e),o.go("game",{idroom:e.id},{reload:!1})},r.newroom=function(){var e=i.getUser();n.emit("rooms:create",{nick:e.nick,idUser:e.idUser,type:window.BINGO_FLAVOR},function(e,o){e||(console.error(o),t.error(o))})}}function n(n,o,i,e,t,r,s,a){t.removeAllListeners();var l,c,u=e.getUser();u?(o.bingoStarted=!1,o.lineaBtnDisabled=!1,o.isGameover=!1,l=i.params.idroom,console.log("Joining room "+l),l=i.params.idroom,n.balls=[],n.cartro=new f,n.mute=!1,n.newCartro=function(){n.cartro.generate()},n.idRoom=l,n.participants=[],n.canSubmitStart=!0,n.headerInfo={idUser:u.idUser,nick:u.nick,id:n.idRoom,typeName:e.getBingoFlavor(),exit:function(){i.go("home")}},t.on("rooms:info",function(e){console.log("Received ROOMS:INFO"),n.currentRoom=e}),t.on("rooms:participants",function(e){return"invalid_room"==e?(console.log("invalid room"),void i.go("rooms")):(console.log("Received ROOMS:PARTICIPANTS"),void(n.participants=e))}),t.on("bingo:start",function(e){n.currentRoom?n.currentRoom.id==e&&(r.info("La partida està apunt de començar."),o.bingoStarted=!0):console.error("Requires room information before starting bingo")}),n.onSubmitStart=function(){t.emit("bingo:start",{id:n.idRoom},function(e){e||(r.error("No ha estat possible començar la partida."),i.go("rooms"))})},c=null,n.remainBalls=30,n.nextAsked=!0,t.on("bingo:nextball",function(e){for(var o=!1,i=0;!o&&i<n.balls;)o=n.balls[i].id==e.id,i++;o||(n.nextAsked=!1,n.balls.unshift(e),n.mute||m.speak(e.speech),console.log(e),n.remainBalls=e.remaining,n.remainTime=e.ttl,c&&s.cancel(c),c=s(function(){--n.remainTime,n.remainTime<=0&&s.cancel(c)},1e3))}),t.on("bingo:gameover",function(){r.info("El joc s'ha acabat."),o.isGameover=!0}),t.on("bingo:linea",function(e){e.res.length&&!o.isGameover&&(e.user.id==u.id&&!1===e.res[0]&&r.warning("La línia no és correcta"),!0===e.res[0]&&(r.success("Línia correcta de "+e.user.nick),o.lineaBtnDisabled=!0))}),t.on("bingo:bingo",function(e){e.res.length&&(!0===e.res[0]?(r.success("Bingo correcte de "+e.user.nick),o.isGameover=!0):e.user.id==u.id&&!1===e.res[0]&&r.warning("El bingo no és correcte"))}),a(function(){t.emit("rooms:join",{id:l,idUser:u.idUser,nick:u.nick},function(e,o){console.log("RESULT JOINING ROOM",e,o),e||(r.error(o),i.go("rooms"))}),t.emit("rooms:info",{id:l}),t.emit("rooms:participants",{id:l},function(e,o){e||(console.error(o),r.error(o),i.go("rooms"))})},400),n.testLinia=function(){console.log("Sending bingo:linea"),console.log("Llista a comprovar ",n.cartro.list()),t.emit("bingo:linea",{id:n.idRoom,numbers:n.cartro.list(),user:u})},n.testBingo=function(){console.log("Sending bingo:bingo"),console.log("Llista a comprovar ",n.cartro.list()),t.emit("bingo:bingo",{id:n.idRoom,numbers:n.cartro.list(),user:u})},n.sortirJoc=function(){i.go("home")},n.askNext=function(){console.log("nextAsked"),n.nextAsked=!0,t.emit("bingo:asknext",{id:n.idRoom,user:u})}):i.go("home")}o.$inject=["$scope","$rootScope","$state","cfg","socket","growl"],i.$inject=["$scope","$rootScope","$state","cfg","socket","growl","$timeout"],n.$inject=["$scope","$rootScope","$state","cfg","socket","growl","$interval","$timeout"],e.controller("LandingCtrl",o),e.controller("RoomsCtrl",i),e.controller("GameCtrl",n),e.config(["$stateProvider","$urlRouterProvider","growlProvider",function(e,o,i){o.otherwise("/"),e.state("home",{url:"/",templateUrl:"landing.html",controller:"LandingCtrl",reload:!1}).state("rooms",{url:"/rooms",templateUrl:"rooms.html",controller:"RoomsCtrl",reload:!0}).state("game",{url:"/game/:idroom",templateUrl:"game.html",controller:"GameCtrl",reload:!0}),i.onlyUniqueMessages(!0),i.globalTimeToLive(5e3),i.globalPosition("top-right"),i.globalDisableCountDown(!0)}])}();